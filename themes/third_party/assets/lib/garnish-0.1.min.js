/*!
 * Garnish UI toolkit
 *
 * @copyright 2013 Pixel & Tonic, Inc.. All rights reserved.
 * @author    Brandon Kelly <brandon@pixelandtonic.com>
 * @version   0.1
 */
(function(c){
/*!
	Base.js, version 1.1a
	Copyright 2006-2010, Dean Edwards
	License: http://www.opensource.org/licenses/mit-license.php
*/
var a=function(){};a.extend=function(e,h){var i=a.prototype.extend;a._prototyping=true;var g=new this;i.call(g,e);g.base=function(){};delete a._prototyping;var f=g.constructor;var d=g.constructor=function(){if(!a._prototyping){if(this._constructing||this.constructor==d){this._constructing=true;f.apply(this,arguments);delete this._constructing}else{if(arguments[0]!=null){return(arguments[0].extend||i).call(arguments[0],g)}}}};d.ancestor=this;d.extend=this.extend;d.forEach=this.forEach;d.implement=this.implement;d.prototype=g;d.toString=this.toString;d.valueOf=function(j){return(j=="object")?d:f.valueOf()};i.call(d,h);if(typeof d.init=="function"){d.init()}return d};a.prototype={extend:function(e,l){if(arguments.length>1){var h=this[e];if(h&&(typeof l=="function")&&(!h.valueOf||h.valueOf()!=l.valueOf())&&/\bbase\b/.test(l)){var d=l.valueOf();l=function(){var n=this.base||a.prototype.base;this.base=h;var i=d.apply(this,arguments);this.base=n;return i};l.valueOf=function(i){return(i=="object")?l:d};l.toString=a.toString}this[e]=l}else{if(e){var k=a.prototype.extend;if(!a._prototyping&&typeof this!="function"){k=this.extend||k}var g={toSource:null};var j=["constructor","toString","valueOf"];var f=a._prototyping?0:1;while(m=j[f++]){if(e[m]!=g[m]){k.call(this,m,e[m])}}for(var m in e){if(!g[m]){k.call(this,m,e[m])}}}}return this}};a=a.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(d,g,f){for(var e in d){if(this.prototype[e]===undefined){g.call(f,d[e],e,d)}}},implement:function(){for(var d=0;d<arguments.length;d++){if(typeof arguments[d]=="function"){arguments[d](this.prototype)}else{this.prototype.extend(arguments[d])}}return this},toString:function(){return String(this.valueOf())}});
/*!
 * Garnish
 */
if(typeof Garnish!="undefined"){throw"Garnish is already defined!"}Garnish={$win:c(window),$doc:c(document),$bod:c(document.body),DELETE_KEY:8,SHIFT_KEY:16,CTRL_KEY:17,ALT_KEY:18,RETURN_KEY:13,ESC_KEY:27,SPACE_KEY:32,LEFT_KEY:37,UP_KEY:38,RIGHT_KEY:39,DOWN_KEY:40,A_KEY:65,CMD_KEY:91,PRIMARY_CLICK:0,SECONDARY_CLICK:2,X_AXIS:"x",Y_AXIS:"y",TEXT_NODE:3,log:function(d){if(typeof console!="undefined"&&typeof console.log=="function"){console.log(d)}},isArray:function(d){return(d instanceof Array)},isJquery:function(d){return(d instanceof jQuery)},isObject:function(d){return(typeof d=="object"&&!Garnish.isArray(d)&&!Garnish.isJquery(d)&&typeof d.nodeType=="undefined")},isString:function(d){return(typeof d=="string")},getDist:function(e,g,d,f){return Math.sqrt(Math.pow(e-d,2)+Math.pow(g-f,2))},hitTest:function(d,f,e){Garnish.hitTest._$elem=c(e),Garnish.hitTest._offset=Garnish.hitTest._$elem.offset(),Garnish.hitTest._x1=Garnish.hitTest._offset.left,Garnish.hitTest._y1=Garnish.hitTest._offset.top,Garnish.hitTest._x2=Garnish.hitTest._x1+Garnish.hitTest._$elem.outerWidth(),Garnish.hitTest._y2=Garnish.hitTest._y1+Garnish.hitTest._$elem.outerHeight();return(d>=Garnish.hitTest._x1&&d<Garnish.hitTest._x2&&f>=Garnish.hitTest._y1&&f<Garnish.hitTest._y2)},isCursorOver:function(e,d){return Garnish.hitTest(e.pageX,e.pageY,d)},copyTextStyles:function(e,f){var g=c(e),d=c(f);d.css({lineHeight:g.css("lineHeight"),fontSize:g.css("fontSize"),fontFamily:g.css("fontFamily"),fontWeight:g.css("fontWeight"),letterSpacing:g.css("letterSpacing"),textAlign:g.css("textAlign")})},getBodyScrollTop:function(){Garnish.getBodyScrollTop._scrollTop=document.body.scrollTop;if(Garnish.getBodyScrollTop._scrollTop<0){Garnish.getBodyScrollTop._scrollTop=0}else{Garnish.getBodyScrollTop._maxScrollTop=Garnish.$bod.outerHeight()-Garnish.$win.height();if(Garnish.getBodyScrollTop._scrollTop>Garnish.getBodyScrollTop._maxScrollTop){Garnish.getBodyScrollTop._scrollTop=Garnish.getBodyScrollTop._maxScrollTop}}return Garnish.getBodyScrollTop._scrollTop},scrollContainerToElement:function(d,h){var k=c(d),e=c(h);var f=k.scrollTop(),i=e.offset().top;if(k[0]==window){var j=i-f}else{var j=i-k.offset().top}if(j<0){k.scrollTop(f+j)}else{var g=e.outerHeight(),l=(k[0]==window?window.innerHeight:k[0].clientHeight);if(j+g>l){k.scrollTop(f+(j-(l-g)))}}},SHAKE_STEPS:10,SHAKE_STEP_DURATION:25,shake:function(g,h){var d=c(g);if(!h){h="margin-left"}var f=parseInt(d.css(h));if(isNaN(f)){f=0}for(var e=0;e<=Garnish.SHAKE_STEPS;e++){(function(j){setTimeout(function(){Garnish.shake._properties={};Garnish.shake._properties[h]=f+(j%2?-1:1)*(10-j);d.animate(Garnish.shake._properties,Garnish.SHAKE_STEP_DURATION)},(Garnish.SHAKE_STEP_DURATION*j))})(e)}}};Garnish.Base=a.extend({settings:null,_namespace:null,_$listeners:null,constructor:function(){this._namespace=".Garnish"+Math.floor(Math.random()*1000000000);this._$listeners=c();this.init.apply(this,arguments)},init:c.noop,setSettings:function(d,e){var f=(typeof this.settings=="undefined"?{}:this.settings);this.settings=c.extend(f,e,d)},_formatEvents:function(e){if(typeof e=="string"){e=e.split(",");for(var d=0;d<e.length;d++){e[d]=c.trim(e[d])}}for(var d=0;d<e.length;d++){e[d]+=this._namespace}return e.join(" ")},addListener:function(h,e,g){var d=c(h);e=this._formatEvents(e);if(typeof g=="function"){g=c.proxy(g,this)}else{g=c.proxy(this,g)}d.on(e,g);this._$listeners=this._$listeners.add(h);if(e.search(/\bactivate\b/)!=-1){if(!d.data("activatable")){var f=this._namespace+"-activate";d.on("mousedown"+f,function(i){i.preventDefault()});d.on("click"+f,function(j){j.preventDefault();var i=c.inArray(j.currentTarget,d),k=c(h[i]);if(!k.hasClass("disabled")){k.trigger("activate")}});d.on("keydown"+f,function(j){var i=c.inArray(j.currentTarget,d);if(i!=-1&&j.keyCode==Garnish.SPACE_KEY){j.preventDefault();var k=c(d[i]);if(!k.hasClass("disabled")){k.addClass("active");Garnish.$doc.on("keyup"+f,function(l){d.removeClass("active");if(l.keyCode==Garnish.SPACE_KEY){l.preventDefault();k.trigger("activate")}Garnish.$doc.off("keyup"+f)})}}});if(!d.hasClass("disabled")){d.attr("tabindex","0")}else{d.removeAttr("tabindex")}d.data("activatable",true)}}},removeListener:function(e,d){d=this._formatEvents(d);c(e).off(d)},removeAllListeners:function(d){c(d).off(this._namespace)},destroy:function(){this.removeAllListeners(this._$listeners)}});Garnish.BaseDrag=Garnish.Base.extend({$items:null,dragging:false,mousedownX:null,mousedownY:null,mouseDistX:null,mouseDistY:null,$targetItem:null,targetItemMouseDiffX:null,targetItemMouseDiffY:null,mouseX:null,mouseY:null,lastMouseX:null,lastMouseY:null,init:function(d,e){if(!e&&Garnish.isObject(d)){e=d;d=null}this.settings=c.extend({},Garnish.BaseDrag.defaults,e);this.$items=c();if(d){this.addItems(d)}},onMouseDown:function(e){if(e.button!=Garnish.PRIMARY_CLICK){return}if(this.$targetItem){return}if(this.settings.ignoreButtons&&e.currentTarget!=e.target){var d=c(e.target);if(d.hasClass("btn")||d.closest(".btn").length){return}}e.preventDefault();this.$targetItem=c(c.data(e.currentTarget,"drag-item"));this.mousedownX=this.mouseX=e.pageX;this.mousedownY=this.mouseY=e.pageY;var f=this.$targetItem.offset();this.targetItemMouseDiffX=e.pageX-f.left;this.targetItemMouseDiffY=e.pageY-f.top;this.addListener(Garnish.$doc,"mousemove","onMouseMove");this.addListener(Garnish.$doc,"mouseup","onMouseUp")},onMouseMove:function(d){d.preventDefault();if(this.settings.axis!=Garnish.Y_AXIS){this.mouseX=d.pageX}if(this.settings.axis!=Garnish.X_AXIS){this.mouseY=d.pageY}this.mouseDistX=this.mouseX-this.mousedownX;this.mouseDistY=this.mouseY-this.mousedownY;if(!this.dragging){this.onMouseMove._mouseDist=Garnish.getDist(this.mousedownX,this.mousedownY,this.mouseX,this.mouseY);if(this.onMouseMove._mouseDist>=Garnish.BaseDrag.minMouseDist){this.startDragging()}else{return}}this.onDrag()},onMouseUp:function(d){this.removeAllListeners(Garnish.$doc);if(this.dragging){this.stopDragging()}this.$targetItem=null},startDragging:function(){this.dragging=true;this.onDragStart()},stopDragging:function(){this.dragging=false;this.onDragStop()},onDragStart:function(){this.settings.onDragStart()},onDrag:function(){this.settings.onDrag()},onDragStop:function(){this.settings.onDragStop()},addItems:function(d){d=c.makeArray(d);for(var e=0;e<d.length;e++){var f=d[e];if(c.data(f,"drag")){Garnish.log("Element was added to more than one dragger");c.data(f,"drag").removeItems(f)}c.data(f,"drag",this);this.$items=this.$items.add(f);if(this.settings.handle){if(typeof this.settings.handle=="object"){var g=c(this.settings.handle)}else{if(typeof this.settings.handle=="string"){var g=c(f).find(this.settings.handle)}else{if(typeof this.settings.handle=="function"){var g=c(this.settings.handle(f))}}}}else{var g=c(f)}c.data(f,"drag-handle",g);g.data("drag-item",f);this.addListener(g,"mousedown","onMouseDown")}},removeItems:function(d){d=c.makeArray(d);for(var f=0;f<d.length;f++){var g=d[f];var e=c.inArray(g,this.$items);if(e!=-1){var h=c.data(g,"drag-handle");h.data("drag-item",null);c.data(g,"drag",null);c.data(g,"drag-handle",null);this.removeAllListeners(h);this.$items.splice(e,1)}}},removeAllItems:function(){for(var d=0;d<this.$items.length;d++){var e=this.$items[d],f=c.data(e,"drag-handle");f.data("drag-item",null);c.data(e,"drag",null);c.data(e,"drag-handle",null);this.removeAllListeners(f)}this.$items=c()}},{minMouseDist:1,defaults:{handle:null,axis:null,ignoreButtons:true,onDragStart:c.noop,onDrag:c.noop,onDragStop:c.noop}});Garnish.CheckboxSelect=Garnish.Base.extend({$container:null,$all:null,$options:null,init:function(d){this.$container=c(d);if(this.$container.data("checkboxSelect")){Garnish.log("Double-instantiating a checkbox select on an element");this.$container.data("checkbox-select").destroy()}this.$container.data("checkboxSelect",this);var e=this.$container.find("input");this.$all=e.filter(".all:first");this.$options=e.not(this.$all);this.addListener(this.$all,"change","onAllChange")},onAllChange:function(){var d=this.$all.prop("checked");this.$options.attr({checked:d,disabled:d})}});Garnish.ContextMenu=Garnish.Base.extend({$target:null,options:null,$menu:null,showingMenu:false,init:function(f,d,e){this.$target=c(f);if(this.$target.data("contextmenu")){Garnish.log("Double-instantiating a context menu on an element");this.$target.data("contextmenu").destroy()}this.$target.data("contextmenu",this);this.options=d;this.setSettings(e,Garnish.ContextMenu.defaults);Garnish.ContextMenu.counter++;this.enable()},buildMenu:function(){this.$menu=c('<ul class="'+this.settings.menuClass+'" style="display: none" />');for(var d in this.options){var e=this.options[d];if(e=="-"){c('<li class="'+this.settings.optionBreakClass+'"></li>').appendTo(this.$menu)}else{var g=c("<li></li>").appendTo(this.$menu),f=c("<a>"+e.label+"</a>").appendTo(g);if(typeof e.onClick=="function"){(function(h,i){setTimeout(c.proxy(function(){h.mousedown(c.proxy(function(j){this.hideMenu();i.call(this.currentTarget,c.extend(j,{currentTarget:this.currentTarget}))},this))},this),1)}).call(this,f,e.onClick)}}}},showMenu:function(d){if(d.type=="mousedown"&&d.button!=Garnish.SECONDARY_CLICK){return}if(d.type=="contextmenu"){d.preventDefault()}if(this.showing&&d.currentTarget==this.currentTarget){return}this.currentTarget=d.currentTarget;if(!this.$menu){this.buildMenu()}this.$menu.appendTo(document.body);this.$menu.show();this.$menu.css({left:d.pageX+1,top:d.pageY-4});this.showing=true;setTimeout(c.proxy(function(){this.addListener(Garnish.$doc,"mousedown","hideMenu")},this),0)},hideMenu:function(){this.removeListener(Garnish.$doc,"mousedown");this.$menu.hide();this.showing=false},enable:function(){this.addListener(this.$target,"contextmenu,mousedown","showMenu")},disable:function(){this.removeListener(this.$target,"contextmenu,mousedown")}},{defaults:{menuClass:"contextmenu",optionBreakClass:"contextmenu-break",},counter:0});Garnish.Drag=Garnish.BaseDrag.extend({$draggee:null,otherItems:null,totalOtherItems:null,helpers:null,helperTargets:null,helperPositions:null,helperLagIncrement:null,updateHelperPosInterval:null,init:function(d,e){if(!e&&Garnish.isObject(d)){e=d;d=null}e=c.extend({},Garnish.Drag.defaults,e);this.base(d,e)},onDragStart:function(){this.helpers=[];this.helperTargets=[];this.helperPositions=[];this.getDraggee();this.draggeeIndex=c.inArray(this.$draggee[0],this.$items);this.draggeeDisplay=this.$draggee.css("display");this.createHelpers();if(this.settings.removeDraggee){this.$draggee.hide()}else{this.$draggee.css("visibility","hidden")}this.lastMouseX=this.lastMouseY=null;this.otherItems=[];for(var d=0;d<this.$items.length;d++){var e=this.$items[d];if(c.inArray(e,this.$draggee)==-1){this.otherItems.push(e)}}this.totalOtherItems=this.otherItems.length;this.helperLagIncrement=this.helpers.length==1?0:Garnish.Drag.helperLagIncrementDividend/(this.helpers.length-1);this.updateHelperPosInterval=setInterval(c.proxy(this,"updateHelperPos"),Garnish.Drag.updateHelperPosInterval);this.base()},onDragStop:function(){clearInterval(this.updateHelperPosInterval);this.base()},getDraggee:function(){switch(typeof this.settings.filter){case"function":this.$draggee=this.settings.filter();break;case"string":this.$draggee=this.$items.filter(this.settings.filter);break;default:this.$draggee=this.$targetItem}this.$draggee=c([this.$targetItem[0]].concat(this.$draggee.not(this.$targetItem[0]).toArray()))},createHelpers:function(){for(var e=0;e<this.$draggee.length;e++){var g=c(this.$draggee[e]),f=g.clone();f.css({width:g.width(),height:g.height(),margin:0});if(typeof this.settings.helper=="function"){f=this.settings.helper(f)}else{if(this.settings.helper){f=c(this.settings.helper).append(f)}}f.appendTo(Garnish.$bod);var d=this.getHelperTarget(e);f.css({position:"absolute",top:d.top,left:d.left,zIndex:Garnish.Drag.helperZindex+this.$draggee.length-e,opacity:this.settings.helperOpacity});this.helperPositions[e]={top:d.top,left:d.left};this.helpers.push(f)}},getHelperTarget:function(d){return{left:this.mouseX-this.targetItemMouseDiffX+(d*Garnish.Drag.helperSpacingX),top:this.mouseY-this.targetItemMouseDiffY+(d*Garnish.Drag.helperSpacingY)}},updateHelperPos:function(){if(this.mouseX!==this.lastMouseX||this.mouseY!==this.lastMouseY){for(this.updateHelperPos._i=0;this.updateHelperPos._i<this.helpers.length;this.updateHelperPos._i++){this.helperTargets[this.updateHelperPos._i]=this.getHelperTarget(this.updateHelperPos._i)}this.lastMouseX=this.mouseX;this.lastMouseY=this.mouseY}for(this.updateHelperPos._j=0;this.updateHelperPos._j<this.helpers.length;this.updateHelperPos._j++){this.updateHelperPos._lag=Garnish.Drag.helperLagBase+(this.helperLagIncrement*this.updateHelperPos._j);this.helperPositions[this.updateHelperPos._j]={left:this.helperPositions[this.updateHelperPos._j].left+((this.helperTargets[this.updateHelperPos._j].left-this.helperPositions[this.updateHelperPos._j].left)/this.updateHelperPos._lag),top:this.helperPositions[this.updateHelperPos._j].top+((this.helperTargets[this.updateHelperPos._j].top-this.helperPositions[this.updateHelperPos._j].top)/this.updateHelperPos._lag)};this.helpers[this.updateHelperPos._j].css(this.helperPositions[this.updateHelperPos._j])}},returnHelpersToDraggees:function(){for(var d=0;d<this.$draggee.length;d++){var g=c(this.$draggee[d]),f=this.helpers[d],e=g.offset();(function(i,h){h.animate({left:e.left,top:e.top},"fast",function(){i.css("visibility","visible");h.remove()})})(g,f)}}},{helperZindex:1000,helperLagBase:1,helperLagIncrementDividend:1.5,updateHelperPosInterval:20,helperSpacingX:5,helperSpacingY:5,defaults:{removeDraggee:false,helperOpacity:1,helper:null}});Garnish.DragDrop=Garnish.Drag.extend({$dropTargets:null,$activeDropTarget:null,init:function(d){d=c.extend({},Garnish.DragDrop.defaults,d);this.base(d)},onDragStart:function(){if(this.settings.dropTargets){if(typeof this.settings.dropTargets=="function"){this.$dropTargets=c(this.settings.dropTargets())}else{this.$dropTargets=c(this.settings.dropTargets)}if(!this.$dropTargets.length){this.$dropTargets=null}}this.$activeDropTarget=null;this.base()},onDrag:function(){if(this.$dropTargets){this.onDrag._activeDropTarget=null;for(this.onDrag._i=0;this.onDrag._i<this.$dropTargets.length;this.onDrag._i++){this.onDrag._elem=this.$dropTargets[this.onDrag._i];if(Garnish.hitTest(this.mouseX,this.mouseY,this.onDrag._elem)){this.onDrag._activeDropTarget=this.onDrag._elem;break}}if((this.$activeDropTarget&&this.onDrag._activeDropTarget!=this.$activeDropTarget[0])||(!this.$activeDropTarget&&this.onDrag._activeDropTarget!==null)){if(this.$activeDropTarget){this.$activeDropTarget.removeClass(this.settings.activeDropTargetClass)}if(this.onDrag._activeDropTarget){this.$activeDropTarget=c(this.onDrag._activeDropTarget).addClass(this.settings.activeDropTargetClass)}else{this.$activeDropTarget=null}this.settings.onDropTargetChange(this.$activeDropTarget)}}this.base()},onDragStop:function(){if(this.$dropTargets&&this.$activeDropTarget){this.$activeDropTarget.removeClass(this.settings.activeDropTargetClass)}this.base()},fadeOutHelpers:function(){for(var d=0;d<this.helpers.length;d++){(function(e){e.fadeOut("fast",function(){e.remove()})})(this.helpers[d])}}},{defaults:{dropTargets:null,onDropTargetChange:c.noop,activeDropTargetClass:"active"}});Garnish.DragMove=Garnish.BaseDrag.extend({onDrag:function(d,e){this.$targetItem.css({left:this.mouseX-this.targetItemMouseDiffX,top:this.mouseY-this.targetItemMouseDiffY})}});Garnish.DragSort=Garnish.Drag.extend({$heightedContainer:null,$insertion:null,$caboose:null,startDraggeeIndex:null,closestItem:null,init:function(d,e){if(!e&&Garnish.isObject(d)){e=d;d=null}e=c.extend({},Garnish.DragSort.defaults,e);this.base(d,e);if(this.settings.caboose){if(typeof this.settings.caboose=="function"){this.$caboose=c(this.settings.caboose())}else{this.$caboose=c(this.settings.caboose)}}},onDragStart:function(){this.base();if(this.settings.container&&this.$caboose){this.$caboose.appendTo(this.settings.container);this.otherItems.push(this.$caboose[0]);this.totalOtherItems++}this.closestItem=null;this.setMidpoints();this.setInsertion();if(this.settings.container){this.$heightedContainer=c(this.settings.container);while(!this.$heightedContainer.height()){this.$heightedContainer=this.$heightedContainer.parent()}}this.startDraggeeIndex=this.draggeeIndex},setInsertion:function(){if(this.settings.insertion){if(typeof this.settings.insertion=="function"){this.$insertion=c(this.settings.insertion(this.$draggee))}else{this.$insertion=c(this.settings.insertion)}}},setMidpoints:function(){for(var e=0;e<this.totalOtherItems;e++){var d=c(this.otherItems[e]),f=d.offset();d.data("midpoint",{left:f.left+d.outerWidth()/2,top:f.top+d.outerHeight()/2})}},onDrag:function(){if(this.$heightedContainer&&!Garnish.hitTest(this.mouseX,this.mouseY,this.$heightedContainer)){if(this.closestItem){this.$insertion.remove();this.closestItem=null}}else{if(this.closestItem!=(this.closestItem=this.getClosestItem())){this.onInsertionPointChange()}}this.base()},getClosestItem:function(){this.getClosestItem._closestItem=null;this.getClosestItem._closestItemMouseDiff=null;for(this.getClosestItem._i=0;this.getClosestItem._i<this.totalOtherItems;this.getClosestItem._i++){this.getClosestItem._$item=c(this.otherItems[this.getClosestItem._i]);this.getClosestItem._midpoint=this.getClosestItem._$item.data("midpoint");this.getClosestItem._mouseDiff=Garnish.getDist(this.getClosestItem._midpoint.left,this.getClosestItem._midpoint.top,this.mouseX,this.mouseY);if(this.getClosestItem._closestItem===null||this.getClosestItem._mouseDiff<this.getClosestItem._closestItemMouseDiff){this.getClosestItem._closestItem=this.getClosestItem._$item[0];this.getClosestItem._closestItemMouseDiff=this.getClosestItem._mouseDiff}}return this.getClosestItem._closestItem},onInsertionPointChange:function(){if(this.closestItem){this.$draggee.insertBefore(this.closestItem);if(this.$insertion){this.$insertion.insertBefore(this.closestItem)}}this.settings.onInsertionPointChange()},onDragStop:function(){if(this.$caboose){this.$caboose.remove()}if(this.$insertion){this.$insertion.remove()}this.$draggee.css({display:this.draggeeDisplay,visibility:"hidden"});this.returnHelpersToDraggees();this.base();this.$items=c().add(this.$items);var d=c.inArray(this.$draggee[0],this.$items);if(this.startDraggeeIndex!=d){this.settings.onSortChange()}}},{defaults:{container:null,insertion:null,onInsertionPointChange:c.noop,onSortChange:c.noop}});Garnish.HUD=Garnish.Base.extend({init:function(d,f,e){this.$trigger=c(d);this.setSettings(e,Garnish.HUD.defaults);this.showing=false;this.$hud=c('<div class="'+this.settings.hudClass+'" />').appendTo(Garnish.$bod);this.$tip=c('<div class="'+this.settings.tipClass+'" />').appendTo(this.$hud);this.$contents=c('<div class="'+this.settings.contentsClass+'" />').appendTo(this.$hud).html(f);this.show();this.addListener(this.$hud,"click",function(g){g.stopPropagation()})},show:function(f){if(this.showing){return}if(Garnish.HUD.active){Garnish.HUD.active.hide()}this.$hud.show();this.windowWidth=Garnish.$win.width();this.windowHeight=Garnish.$win.height();this.windowScrollLeft=Garnish.$win.scrollLeft();this.windowScrollTop=Garnish.$win.scrollTop();this.triggerWidth=this.$trigger.outerWidth();this.triggerHeight=this.$trigger.outerHeight();this.triggerOffset=this.$trigger.offset();this.triggerOffsetRight=this.triggerOffset.left+this.triggerWidth;this.triggerOffsetBottom=this.triggerOffset.top+this.triggerHeight;this.triggerOffsetLeft=this.triggerOffset.left;this.triggerOffsetTop=this.triggerOffset.top;this.width=this.$hud.width();this.height=this.$hud.height();this.minHorizontalClearance=this.width+this.settings.triggerSpacing+this.settings.windowSpacing;this.minVerticalClearance=this.height+this.settings.triggerSpacing+this.settings.windowSpacing;this.rightClearance=this.windowWidth+this.windowScrollLeft-this.triggerOffsetRight;this.bottomClearance=this.windowHeight+this.windowScrollTop-this.triggerOffsetBottom;this.leftClearance=this.triggerOffsetLeft-this.windowScrollLeft;this.topClearance=this.triggerOffsetTop-this.windowScrollTop;if(this.bottomClearance>=this.minVerticalClearance){var i=this.triggerOffsetBottom+this.settings.triggerSpacing;this.$hud.css("top",i);this._setLeftPos();this._setTipClass("top")}else{if(this.rightClearance>=this.minHorizontalClearance){var h=this.triggerOffsetRight+this.settings.triggerSpacing;this.$hud.css("left",h);this._setTopPos();this._setTipClass("left")}else{if(this.leftClearance>=this.minHorizontalClearance){var h=this.triggerOffsetLeft-(this.width+this.settings.triggerSpacing);this.$hud.css("left",h);this._setTopPos();this._setTipClass("right")}else{if(this.topClearance>=this.minVerticalClearance){var i=this.triggerOffsetTop-(this.height+this.settings.triggerSpacing);this.$hud.css("top",i);this._setLeftPos();this._setTipClass("bottom")}else{var e=this.minHorizontalClearance-this.rightClearance,g=this.minVerticalClearance-this.bottomClearance;if(e>=g){var h=this.windowWidth-(this.width+this.settings.windowSpacing),d=this.triggerOffsetLeft+this.settings.triggerSpacing;if(h<d){h=d}this.$hud.css("left",h);this._setTopPos();this._setTipClass("left")}else{var i=this.windowHeight-(this.height+this.settings.windowSpacing),j=this.triggerOffsetTop+this.settings.triggerSpacing;if(i<j){i=j}this.$hud.css("top",i);this._setLeftPos();this._setTipClass("top")}}}}}if(f&&f.stopPropagation){f.stopPropagation()}this.addListener(Garnish.$bod,"click","hide");this.showing=true;Garnish.HUD.active=this;this.settings.onShow()},_setTopPos:function(){var g=(this.windowHeight+this.windowScrollTop)-(this.height+this.settings.windowSpacing),h=(this.windowScrollTop+this.settings.windowSpacing),d=this.triggerOffsetTop+Math.round(this.triggerHeight/2),f=d-Math.round(this.height/2);if(f>g){f=g}if(f<h){f=h}this.$hud.css("top",f);var e=(d-f)-(this.settings.tipWidth/2);this.$tip.css({top:e,left:""})},_setLeftPos:function(){var f=(this.windowWidth+this.windowScrollLeft)-(this.width+this.settings.windowSpacing),e=(this.windowScrollLeft+this.settings.windowSpacing),g=this.triggerOffsetLeft+Math.round(this.triggerWidth/2),h=g-Math.round(this.width/2);if(h>f){h=f}if(h<e){h=e}this.$hud.css("left",h);var d=(g-h)-(this.settings.tipWidth/2);this.$tip.css({left:d,top:""})},_setTipClass:function(d){if(this.tipClass){this.$tip.removeClass(this.tipClass)}this.tipClass=this.settings.tipClass+"-"+d;this.$tip.addClass(this.tipClass)},hide:function(){this.$hud.hide();this.showing=false;Garnish.HUD.active=null;this.settings.onHide()}},{defaults:{hudClass:"hud",tipClass:"tip",contentsClass:"contents",triggerSpacing:7,windowSpacing:20,tipWidth:8,onShow:c.noop,onHide:c.noop}});Garnish.LightSwitch=Garnish.Base.extend({settings:null,$outerContainer:null,$innerContainer:null,$input:null,$toggleTarget:null,on:null,dragger:null,dragStartMargin:null,init:function(d,e){this.$outerContainer=c(d);if(this.$outerContainer.data("lightswitch")){Garnish.log("Double-instantiating a switch on an element");this.$outerContainer.data("lightswitch").destroy()}this.$outerContainer.data("lightswitch",this);this.setSettings(e,Garnish.LightSwitch.defaults);this.$innerContainer=this.$outerContainer.find(".container:first");this.$input=this.$outerContainer.find("input:first");this.$toggleTarget=c(this.$outerContainer.attr("data-toggle"));this.on=this.$outerContainer.hasClass("on");this.addListener(this.$outerContainer,"mousedown","_onMouseDown");this.addListener(this.$outerContainer,"keydown","_onKeyDown");this.dragger=new Garnish.BaseDrag(this.$outerContainer,{axis:Garnish.X_AXIS,ignoreButtons:false,onDragStart:c.proxy(this,"_onDragStart"),onDrag:c.proxy(this,"_onDrag"),onDragStop:c.proxy(this,"_onDragStop")})},turnOn:function(){this.$innerContainer.stop().animate({marginLeft:0},"fast");this.$input.val(Garnish.Y_AXIS);this.on=true;this.settings.onChange();this.$toggleTarget.show();this.$toggleTarget.height("auto");var d=this.$toggleTarget.height();this.$toggleTarget.height(0);this.$toggleTarget.stop().animate({height:d},"fast",c.proxy(function(){this.$toggleTarget.height("auto")},this))},turnOff:function(){this.$innerContainer.stop().animate({marginLeft:Garnish.LightSwitch.offMargin},"fast");this.$input.val("");this.on=false;this.settings.onChange();this.$toggleTarget.stop().animate({height:0},"fast")},toggle:function(d){if(!this.on){this.turnOn()}else{this.turnOff()}},_onMouseDown:function(){this.addListener(Garnish.$doc,"mouseup","_onMouseUp")},_onMouseUp:function(){this.removeListener(Garnish.$doc,"mouseup");if(!this.dragger.dragging){this.toggle()}},_onKeyDown:function(d){switch(d.keyCode){case Garnish.SPACE_KEY:this.toggle();d.preventDefault();break;case Garnish.RIGHT_KEY:this.turnOn();d.preventDefault();break;case Garnish.LEFT_KEY:this.turnOff();d.preventDefault();break}},_getMargin:function(){return parseInt(this.$innerContainer.css("marginLeft"))},_onDragStart:function(){this.dragStartMargin=this._getMargin()},_onDrag:function(){var d=this.dragStartMargin+this.dragger.mouseDistX;if(d<Garnish.LightSwitch.offMargin){d=Garnish.LightSwitch.offMargin}else{if(d>0){d=0}}this.$innerContainer.css("marginLeft",d)},_onDragStop:function(){var d=this._getMargin();if(d>-16){this.turnOn()}else{this.turnOff()}},destroy:function(){this.base();this.dragger.destroy()}},{offMargin:-50,defaults:{onChange:c.noop}});Garnish.Menu=Garnish.Base.extend({settings:null,$container:null,$options:null,init:function(d,e){this.setSettings(e,Garnish.Menu.defaults);this.$container=c(d).appendTo(Garnish.$bod);this.$options=this.$container.find("li");this.addListener(this.$options,"mousedown","selectOption")},setPosition:function(f){var g=f.offset(),e=f.outerWidth(),d={top:g.top+f.outerHeight(),minWidth:(e-32)};if(this.$container.attr("data-align")=="right"){d.right=1+Garnish.$win.width()-(g.left+e)}else{d.left=1+g.left}this.$container.css(d)},show:function(){this.$container.fadeIn(50)},hide:function(){this.$container.fadeOut("fast")},selectOption:function(d){this.settings.onOptionSelect(d.currentTarget)}},{defaults:{onOptionSelect:c.noop}});Garnish.MenuBtn=Garnish.Base.extend({$btn:null,menu:null,showingMenu:false,init:function(d,f){this.$btn=c(d);if(this.$btn.data("menubtn")){Garnish.log("Double-instantiating a menu button on an element");this.$btn.data("menubtn").destroy()}this.$btn.data("menubtn",this);this.setSettings(f,Garnish.MenuBtn.defaults);var e=this.$btn.next(".menu");this.menu=new Garnish.Menu(e,{onOptionSelect:c.proxy(this,"onOptionSelect")});this.addListener(this.$btn,"mousedown","onMouseDown")},onMouseDown:function(d){if(d.button!=Garnish.PRIMARY_CLICK||d.metaKey){return}d.preventDefault();if(this.showingMenu){this.hideMenu()}else{this.showMenu()}},showMenu:function(){this.menu.setPosition(this.$btn);this.menu.show();this.$btn.addClass("active");this.showingMenu=true;setTimeout(c.proxy(function(){this.addListener(Garnish.$doc,"mousedown","onMouseDown")},this),1)},hideMenu:function(){this.menu.hide();this.$btn.removeClass("active");this.showingMenu=false;this.removeListener(Garnish.$doc,"mousedown")},onOptionSelect:function(d){this.settings.onOptionSelect(d)}},{defaults:{onOptionSelect:c.noop}});Garnish.MixedInput=Garnish.Base.extend({$container:null,elements:null,focussedElement:null,blurTimeout:null,init:function(d,e){this.$container=c(d);this.setSettings(e,Garnish.MixedInput.defaults);this.elements=[];this.$container.attr("tabindex",0);this.addListener(this.$container,"focus","onFocus")},getElementIndex:function(d){return c.inArray(d,this.elements)},isText:function(d){return(d.prop("nodeName")=="INPUT")},onFocus:function(e){if(this.elements.length){var d=this.elements[0];this.setFocus(d);this.setCarotPos(d,0)}else{this.addTextElement()}},addTextElement:function(d){var e=new b(this);this.addElement(e.$input,d);return e},addElement:function(d,h){if(typeof h=="undefined"){if(this.focussedElement){var k=this.focussedElement,i=this.getElementIndex(k);if(this.isText(k)){var l=k.prop("selectionStart"),m=k.prop("selectionEnd"),e=k.val(),f=e.substring(0,l),j=e.substr(m);if(f&&j){k.val(f).trigger("change");var g=new b(this);g.$input.val(j).trigger("change");this.addElement(g.$input,i+1);h=i+1}else{if(!f){h=i}else{h=i+1}}}else{h=i+1}}else{h=this.elements.length}}if(typeof this.elements[h]!="undefined"){d.insertBefore(this.elements[h]);this.elements.splice(h,0,d)}else{h=this.elements.length;this.$container.append(d);this.elements.push(d)}if(!this.isText(d)){if(h==0||!this.isText(this.elements[h-1])){this.addTextElement(h);h++}if(h==this.elements.length-1||!this.isText(this.elements[h+1])){this.addTextElement(h+1)}}this.addListener(d,"click",function(){this.setFocus(d)});setTimeout(c.proxy(function(){this.setFocus(d)},this),1)},removeElement:function(d){var f=this.getElementIndex(d);if(f!=-1){this.elements.splice(f,1);if(!this.isText(d)){var i=this.elements[f-1],g=this.elements[f];if(this.isText(i)&&this.isText(g)){var h=i.val(),e=h+g.val();i.val(e).trigger("change");this.removeElement(g);this.setFocus(i);this.setCarotPos(i,h.length)}}d.remove()}},setFocus:function(d){this.$container.addClass("focus");if(!this.focussedElement){this.$container.attr("tabindex","-1")}else{this.blurFocussedElement()}d.attr("tabindex","0");d.focus();this.focussedElement=d;this.addListener(d,"blur",function(){this.blurTimeout=setTimeout(c.proxy(function(){if(this.focussedElement==d){this.blurFocussedElement();this.focussedElement=null;this.$container.removeClass("focus");this.$container.attr("tabindex","0")}},this),1)})},blurFocussedElement:function(){this.removeListener(this.focussedElement,"blur");this.focussedElement.attr("tabindex","-1")},focusPreviousElement:function(g){var e=this.getElementIndex(g);if(e>0){var d=this.elements[e-1];this.setFocus(d);if(this.isText(d)){var f=d.val().length;this.setCarotPos(d,f)}}},focusNextElement:function(f){var e=this.getElementIndex(f);if(e<this.elements.length-1){var d=this.elements[e+1];this.setFocus(d);if(this.isText(d)){this.setCarotPos(d,0)}}},setCarotPos:function(d,e){d.prop("selectionStart",e);d.prop("selectionEnd",e)}});var b=Garnish.Base.extend({parentInput:null,$input:null,$stage:null,val:null,focussed:false,interval:null,init:function(d){this.parentInput=d;this.$input=c('<input type="text"/>').appendTo(this.parentInput.$container);this.$input.css("margin-right",(2-b.padding)+"px");this.setWidth();this.addListener(this.$input,"focus","onFocus");this.addListener(this.$input,"blur","onBlur");this.addListener(this.$input,"keydown","onKeyDown");this.addListener(this.$input,"change","checkInput")},getIndex:function(){return this.parentInput.getElementIndex(this.$input)},buildStage:function(){this.$stage=c("<stage/>").appendTo(Garnish.$bod);this.$stage.css({position:"absolute",top:-9999,left:-9999,wordWrap:"nowrap"});Garnish.copyTextStyles(this.$input,this.$stage)},getTextWidth:function(d){if(!this.$stage){this.buildStage()}if(d){d=d.replace(/&/g,"&amp;");d=d.replace(/</g,"&lt;");d=d.replace(/>/g,"&gt;");d=d.replace(/ /g,"&nbsp;")}this.$stage.html(d);this.stageWidth=this.$stage.width();return this.stageWidth},onFocus:function(){this.focussed=true;this.interval=setInterval(c.proxy(this,"checkInput"),Garnish.NiceText.interval);this.checkInput()},onBlur:function(){this.focussed=false;clearInterval(this.interval);this.checkInput()},onKeyDown:function(d){setTimeout(c.proxy(this,"checkInput"),1);switch(d.keyCode){case Garnish.LEFT_KEY:if(this.$input.prop("selectionStart")==0&&this.$input.prop("selectionEnd")==0){this.parentInput.focusPreviousElement(this.$input)}break;case Garnish.RIGHT_KEY:if(this.$input.prop("selectionStart")==this.val.length&&this.$input.prop("selectionEnd")==this.val.length){this.parentInput.focusNextElement(this.$input)}break;case Garnish.DELETE_KEY:if(this.$input.prop("selectionStart")==0&&this.$input.prop("selectionEnd")==0){this.parentInput.focusPreviousElement(this.$input);d.preventDefault()}}},getVal:function(){this.val=this.$input.val();return this.val},setVal:function(d){this.$input.val(d);this.checkInput()},checkInput:function(){var d=(this.val!==this.getVal());if(d){this.setWidth();this.onChange()}return d},setWidth:function(){if(this.stageWidth!==this.getTextWidth(this.val)){var d=this.stageWidth+b.padding;this.$input.width(d)}},onChange:c.noop},{padding:20});Garnish.Modal=Garnish.Base.extend({$container:null,$header:null,$body:null,$scrollpane:null,$footer:null,$footerBtns:null,$submitBtn:null,_headerHeight:null,_footerHeight:null,visible:false,dragger:null,init:function(d,e){if(!e&&Garnish.isObject(d)){e=d;items=null}this.setSettings(e,Garnish.Modal.defaults);if(d){this.setContainer(d);this.show()}Garnish.Modal.instances.push(this)},setContainer:function(d){this.$container=c(d);if(this.$container.data("modal")){Garnish.log("Double-instantiating a modal on an element");this.$container.data("modal").destroy()}this.$container.data("modal",this);this.$header=this.$container.find(".pane-head:first");this.$body=this.$container.find(".pane-body:first");this.$scrollpane=this.$body.children(".scrollpane:first");this.$footer=this.$container.find(".pane-foot:first");this.$footerBtns=this.$footer.find(".btn");this.$submitBtn=this.$footerBtns.filter(".submit:first");this.$closeBtn=this.$footerBtns.filter(".close:first");if(this.settings.draggable){var e=this.$header.add(this.$footer);if(e.length){this.dragger=new Garnish.DragMove(this.$container,{handle:this.$container})}}this.addListener(this.$container,"keydown","onKeyDown");this.addListener(this.$closeBtn,"click","hide")},show:function(){if(Garnish.Modal.visibleModal){Garnish.Modal.visibleModal.hide()}if(this.$container){this.$container.show();this.centerInViewport();this.$container.delay(50).fadeIn();this.addListener(Garnish.$win,"resize","centerInViewport")}this.visible=true;Garnish.Modal.visibleModal=this;Garnish.Modal.$shade.fadeIn(50);this.addListener(Garnish.Modal.$shade,"click","hide")},hide:function(){if(this.$container){this.$container.fadeOut("fast");this.removeListener(Garnish.$win,"resize")}this.visible=false;Garnish.Modal.visibleModal=null;Garnish.Modal.$shade.fadeOut("fast");this.removeListener(Garnish.Modal.$shade,"click")},getHeight:function(){if(!this.$container){throw"Attempted to get the height of a modal whose container has not been set."}if(!this.visible){this.$container.show()}var d=this.$container.outerHeight();if(!this.visible){this.$container.hide()}return d},getWidth:function(){if(!this.$container){throw"Attempted to get the width of a modal whose container has not been set."}if(!this.visible){this.$container.show()}var d=this.$container.outerWidth();if(!this.visible){this.$container.hide()}return d},centerInViewport:function(){if(!this.$container){throw"Attempted to position a modal whose container has not been set."}var e=Garnish.$win.width(),g=Garnish.$win.height(),d=this.getWidth(),f=this.getHeight(),i=Math.round((e-d)/2),h=Math.round((g-f)/2);this.$container.css({top:h,left:i})},positionRelativeTo:function(h){if(!this.$container){throw"Attempted to position a modal whose container has not been set."}var e=c(h),j=e.offset(),g=Garnish.$bod.scrollTop(),f=j.top-g,d=this.getHeight();if(d<f+Garnish.navHeight+Garnish.Modal.relativeElemPadding*2){var i=j.top-d-Garnish.Modal.relativeElemPadding}else{var i=j.top+e.height()+Garnish.Modal.relativeElemPadding}this.$container.css({top:i,left:j.left})},onKeyDown:function(d){if(d.target.nodeName!="TEXTAREA"&&d.keyCode==Garnish.RETURN_KEY){this.$submitBtn.click()}},destroy:function(){this.base();if(this.dragger){this.dragger.destroy()}}},{relativeElemPadding:8,defaults:{draggable:true},instances:[],visibleModal:null,$shade:c('<div class="modal-shade"/>').appendTo(Garnish.$bod)});Garnish.NiceText=Garnish.Base.extend({$input:null,$hint:null,$stage:null,autoHeight:null,focussed:false,showingHint:false,val:null,stageHeight:null,minHeight:null,interval:null,init:function(d,e){this.$input=c(d);this.settings=c.extend({},Garnish.NiceText.defaults,e);if(this.$input.data("nicetext")){Garnish.log("Double-instantiating a transparent text input on an element");this.$input.data("nicetext").destroy()}this.$input.data("nicetext",this);this.getVal();this.autoHeight=(this.settings.autoHeight&&this.$input.prop("nodeName")=="TEXTAREA");if(this.autoHeight){this.minHeight=this.getStageHeight("");this.setHeight();this.addListener(Garnish.$win,"resize","setHeight")}if(this.settings.hint){this.$hintContainer=c('<div class="texthint-container"/>').insertBefore(this.$input);this.$hint=c('<div class="texthint">'+this.settings.hint+"</div>").appendTo(this.$hintContainer);this.$hint.css({top:(parseInt(this.$input.css("borderTopWidth"))+parseInt(this.$input.css("paddingTop"))),left:(parseInt(this.$input.css("borderLeftWidth"))+parseInt(this.$input.css("paddingLeft"))+1)});Garnish.copyTextStyles(this.$input,this.$hint);if(this.val){this.$hint.hide()}else{this.showingHint=true}this.addListener(this.$hint,"mousedown",function(f){f.preventDefault();this.$input.focus()})}this.addListener(this.$input,"focus","onFocus");this.addListener(this.$input,"blur","onBlur");this.addListener(this.$input,"keydown","onKeyDown")},getVal:function(){this.val=this.$input.val();return this.val},showHint:function(){this.$hint.fadeIn(Garnish.NiceText.hintFadeDuration);this.showingHint=true},hideHint:function(){this.$hint.fadeOut(Garnish.NiceText.hintFadeDuration);this.showingHint=false},checkInput:function(){var d=(this.val!==this.getVal());if(d){if(this.$hint){if(this.showingHint&&this.val){this.hideHint()}else{if(!this.showingHint&&!this.val){this.showHint()}}}if(this.autoHeight){this.setHeight()}}return d},buildStage:function(){this.$stage=c("<stage/>").appendTo(Garnish.$bod);this.$stage.css({position:"absolute",top:-9999,left:-9999,wordWrap:"break-word"});Garnish.copyTextStyles(this.$input,this.$stage)},getStageHeight:function(e){if(!this.$stage){this.buildStage()}this.$stage.css("width",this.$input.width());if(!e){e="&nbsp;";for(var d=1;d<this.$input.prop("rows");d++){e+="<br/>&nbsp;"}}else{e=e.replace(/&/g,"&amp;");e=e.replace(/</g,"&lt;");e=e.replace(/>/g,"&gt;");e=e.replace(/ /g,"&nbsp;");e=e.replace(/[\n\r]$/g,"<br/>&nbsp;");e=e.replace(/[\n\r]/g,"<br/>");e+="<br/>&nbsp;"}this.$stage.html(e);this.stageHeight=this.$stage.height();return this.stageHeight},setHeight:function(){if(this.stageHeight!==this.getStageHeight(this.val)){var d=this.stageHeight;if(d<this.minHeight){d=this.minHeight}this.$input.height(d)}},onFocus:function(){this.focussed=true;this.interval=setInterval(c.proxy(this,"checkInput"),Garnish.NiceText.interval);this.checkInput()},onBlur:function(){this.focussed=false;clearInterval(this.interval);this.checkInput()},onKeyDown:function(){setTimeout(c.proxy(this,"checkInput"),1)},destroy:function(){this.base();this.$hint.remove();this.$stage.remove()}},{interval:100,hintFadeDuration:50,defaults:{autoHeight:true}});Garnish.PasswordInput=Garnish.Base.extend({$passwordInput:null,$textInput:null,$currentInput:null,$showPasswordToggle:null,showingPassword:null,showingCapsIcon:null,init:function(d){this.$passwordInput=c(d);if(this.$passwordInput.data("passwordInput")){Garnish.log("Double-instantiating a password input on an element");this.$passwordInput.data("passwordInput").destroy()}this.$passwordInput.data("passwordInput",this);this.showingCapsIcon=false;this.$showPasswordToggle=c("<a/>").hide();this.$showPasswordToggle.addClass("password-toggle");this.$showPasswordToggle.insertAfter(this.$passwordInput);this.addListener(this.$showPasswordToggle,"mousedown","onToggleMouseDown");this.hidePassword()},setCurrentInput:function(d){if(this.$currentInput){d.addClass("focus");this.$currentInput.replaceWith(d);d.focus();d.removeClass("focus");d.val(this.$currentInput.val())}this.$currentInput=d;this.addListener(this.$currentInput,"focus","onFocus");this.addListener(this.$currentInput,"keypress","onKeyPress");this.addListener(this.$currentInput,"keypress,keyup,change,blur","onInputChange")},updateToggleLabel:function(d){this.$showPasswordToggle.text(d)},showPassword:function(){if(this.showingPassword){return}this.hideCapsIcon();if(!this.$textInput){this.$textInput=this.$passwordInput.clone(true);this.$textInput.attr("type","text")}this.setCurrentInput(this.$textInput);this.updateToggleLabel(Garnish.PasswordInput.lang.Hide);this.showingPassword=true},hidePassword:function(){if(this.showingPassword===false){return}this.setCurrentInput(this.$passwordInput);this.updateToggleLabel(Garnish.PasswordInput.lang.Show);this.showingPassword=false;this.addListener(this.$passwordInput,"keydown","onKeyDown")},togglePassword:function(){if(this.showingPassword){this.hidePassword()}else{this.showPassword()}},showCapsIcon:function(){if(this.showingCapsIcon){return}this.$currentInput.addClass("capslock");this.showingCapsIcon=true},hideCapsIcon:function(){if(!this.showingCapsIcon){return}this.$currentInput.removeClass("capslock");this.showingCapsIcon=false},onFocus:function(){this.hideCapsIcon()},onKeyDown:function(d){if(d.keyCode==Garnish.ALT_KEY&&this.$currentInput.val()){this.showPassword();this.$showPasswordToggle.hide();this.addListener(this.$textInput,"keyup","onKeyUp")}},onKeyUp:function(d){d.preventDefault();if(d.keyCode==Garnish.ALT_KEY){this.hidePassword();this.$showPasswordToggle.show()}},onKeyPress:function(d){if(this.showingPassword){return}if(!d.shiftKey&&!d.metaKey){var e=String.fromCharCode(d.which);if(e.toUpperCase()===e&&e.toLowerCase()!==e){this.showCapsIcon()}else{if(e.toLowerCase()===e&&e.toUpperCase()!==e){this.hideCapsIcon()}}}},onInputChange:function(){if(this.$currentInput.val()){this.$showPasswordToggle.show()}else{this.$showPasswordToggle.hide()}},onToggleMouseDown:function(d){d.preventDefault();if(this.$currentInput[0].setSelectionRange){var e=this.$currentInput[0].selectionStart,f=this.$currentInput[0].selectionEnd}this.togglePassword();if(this.$currentInput[0].setSelectionRange){this.$currentInput[0].setSelectionRange(e,f)}}},{lang:{Show:"Show",Hide:"Hide"}});Garnish.Pill=Garnish.Base.extend({$outerContainer:null,$innerContainer:null,$btns:null,$selectedBtn:null,$input:null,init:function(d){this.$outerContainer=c(d);if(this.$outerContainer.data("pill")){Garnish.log("Double-instantiating a pill on an element");this.$outerContainer.data("pill").destroy()}this.$outerContainer.data("pill",this);this.$innerContainer=this.$outerContainer.find(".btngroup:first");this.$btns=this.$innerContainer.find(".btn");this.$selectedBtn=this.$btns.filter(".active:first");this.$input=this.$outerContainer.find("input:first");Garnish.preventOutlineOnMouseFocus(this.$innerContainer);this.addListener(this.$btns,"mousedown","onMouseDown");this.addListener(this.$innerContainer,"keydown","onKeyDown")},select:function(d){this.$selectedBtn.removeClass("active");var e=c(d);e.addClass("active");this.$input.val(e.attr("data-value"));this.$selectedBtn=e},onMouseDown:function(d){this.select(d.currentTarget)},_getSelectedBtnIndex:function(){if(typeof this.$selectedBtn[0]!="undefined"){return c.inArray(this.$selectedBtn[0],this.$btns)}else{return -1}},onKeyDown:function(f){switch(f.keyCode){case Garnish.RIGHT_KEY:if(!this.$selectedBtn.length){this.select(this.$btns[this.$btns.length-1])}else{var d=this._getSelectedBtnIndex()+1;if(typeof this.$btns[d]!="undefined"){this.select(this.$btns[d])}}f.preventDefault();break;case Garnish.LEFT_KEY:if(!this.$selectedBtn.length){this.select(this.$btns[0])}else{var e=this._getSelectedBtnIndex()-1;if(typeof this.$btns[e]!="undefined"){this.select(this.$btns[e])}}f.preventDefault();break}}});Garnish.Select=Garnish.Base.extend({$container:null,$items:null,totalSelected:null,mousedownX:null,mousedownY:null,mouseUpTimeout:null,mouseUpTimeoutDuration:null,callbackTimeout:null,$focusable:null,$first:null,first:null,$last:null,last:null,init:function(d,e,f){this.$container=c(d);if(!f&&Garnish.isObject(e)){f=e;e=null}if(this.$container.data("select")){Garnish.log("Double-instantiating a select on an element");this.$container.data("select").destroy()}this.$container.data("select",this);this.setSettings(f,Garnish.Select.defaults);this.mouseUpTimeoutDuration=(this.settings.waitForDblClick?300:0);this.$items=c();this.addItems(e);this.addListener(this.$container,"click",function(g){if(this.ignoreClick){this.ignoreClick=false}else{this.deselectAll(true)}})},getItemIndex:function(d){return this.$items.index(d[0])},isSelected:function(d){return d.hasClass(this.settings.selectedClass)},selectItem:function(d){if(!this.settings.multi){this.deselectAll()}d.addClass(this.settings.selectedClass);this.$first=this.$last=d;this.first=this.last=this.getItemIndex(d);this.setFocusableItem(d);d.focus();this.totalSelected++;this.setCallbackTimeout()},selectAll:function(){if(!this.settings.multi||!this.$items.length){return}this.first=0;this.last=this.$items.length-1;this.$first=c(this.$items[this.first]);this.$last=c(this.$items[this.last]);this.$items.addClass(this.settings.selectedClass);this.totalSelected=this.$items.length;this.setCallbackTimeout()},selectRange:function(e){if(!this.settings.multi){return this.selectItem(e)}this.deselectAll();this.$last=e;this.last=this.getItemIndex(e);this.setFocusableItem(e);e.focus();if(this.first<this.last){var d=this.first,f=this.last+1}else{var d=this.last,f=this.first+1}this.$items.slice(d,f).addClass(this.settings.selectedClass);this.totalSelected=f-d;this.setCallbackTimeout()},deselectItem:function(d){d.removeClass(this.settings.selectedClass);var e=this.getItemIndex(d);if(this.first===e){this.$first=this.first=null}if(this.last===e){this.$last=this.last=null}this.totalSelected--;this.setCallbackTimeout()},deselectAll:function(d){this.$items.removeClass(this.settings.selectedClass);if(d){this.$first=this.first=this.$last=this.last=null}this.totalSelected=0;this.setCallbackTimeout()},deselectOthers:function(d){this.deselectAll();this.selectItem(d)},toggleItem:function(d){if(!this.isSelected(d)){this.selectItem(d)}else{this.deselectItem(d)}},clearMouseUpTimeout:function(){clearTimeout(this.mouseUpTimeout)},onMouseDown:function(e){if(e.button!=Garnish.PRIMARY_CLICK){return}this.mousedownX=e.pageX;this.mousedownY=e.pageY;var d=c(c.data(e.currentTarget,"select-item"));if(e.metaKey){this.toggleItem(d)}else{if(this.first!==null&&e.shiftKey){this.selectRange(d)}else{if(!this.isSelected(d)){this.deselectAll();this.selectItem(d)}}}},onMouseUp:function(e){if(e.button!=Garnish.PRIMARY_CLICK){return}var d=c(c.data(e.currentTarget,"select-item"));if(!e.metaKey&&!e.shiftKey&&Garnish.getDist(this.mousedownX,this.mousedownY,e.pageX,e.pageY)<1){this.selectItem(d);this.clearMouseUpTimeout();this.mouseUpTimeout=setTimeout(c.proxy(function(){this.deselectOthers(d)},this),this.mouseUpTimeoutDuration)}},onKeyDown:function(f){var g=(f.metaKey||f.ctrlKey);if(this.settings.arrowsChangeSelection||!this.$focusable.length){var e=f.shiftKey?this.last:this.first}else{var e=c.inArray(this.$focusable[0],this.$items);if(e==-1){e=0}}switch(f.keyCode){case Garnish.LEFT_KEY:f.preventDefault();if(this.first===null){var d=this.getLastItem()}else{if(g){var d=this.getFurthestItemToTheLeft(e)}else{var d=this.getItemToTheLeft(e)}}break;case Garnish.RIGHT_KEY:f.preventDefault();if(this.first===null){var d=this.getFirstItem()}else{if(g){var d=this.getFurthestItemToTheRight(e)}else{var d=this.getItemToTheRight(e)}}break;case Garnish.UP_KEY:f.preventDefault();if(this.first===null){var d=this.getLastItem()}else{if(g){var d=this.getFurthestItemAbove(e)}else{var d=this.getItemAbove(e)}if(!d){d=this.getFirstItem()}}break;case Garnish.DOWN_KEY:f.preventDefault();if(this.first===null){var d=this.getFirstItem()}else{if(g){var d=this.getFurthestItemBelow(e)}else{var d=this.getItemBelow(e)}if(!d){d=this.getLastItem()}}break;case Garnish.SPACE_KEY:if(!g){f.preventDefault();if(this.isSelected(this.$focusable)){this.deselectItem(this.$focusable)}else{this.selectItem(this.$focusable)}}break;case Garnish.A_KEY:if(g){f.preventDefault();this.selectAll()}break}if(d&&d.length){if(this.settings.arrowsChangeSelection){if(this.first!==null&&f.shiftKey){this.selectRange(d)}else{this.deselectAll();this.selectItem(d)}}else{this.setFocusableItem(d);d.focus()}}},getFirstItem:function(){if(this.$items.length){return c(this.$items[0])}},getLastItem:function(){if(this.$items.length){return c(this.$items[this.$items.length-1])}},isPreviousItem:function(d){return(d>0)},isNextItem:function(d){return(d<this.$items.length-1)},getPreviousItem:function(d){if(this.isPreviousItem(d)){return c(this.$items[d-1])}},getNextItem:function(d){if(this.isNextItem(d)){return c(this.$items[d+1])}},getItemToTheLeft:function(d){if(this.isPreviousItem(d)){if(this.settings.horizontal){return this.getPreviousItem(d)}if(!this.settings.vertical){return this.getClosestItem(d,Garnish.X_AXIS,"<")}}},getItemToTheRight:function(d){if(this.isNextItem(d)){if(this.settings.horizontal){return this.getNextItem(d)}else{if(!this.settings.vertical){return this.getClosestItem(d,Garnish.X_AXIS,">")}}}},getItemAbove:function(d){if(this.isPreviousItem(d)){if(this.settings.vertical){return this.getPreviousItem(d)}else{if(!this.settings.horizontal){return this.getClosestItem(d,Garnish.Y_AXIS,"<")}}}},getItemBelow:function(d){if(this.isNextItem(d)){if(this.settings.vertical){return this.getNextItem(d)}else{if(!this.settings.horizontal){return this.getClosestItem(d,Garnish.Y_AXIS,">")}}}},getClosestItem:function(k,e,f){var d=Garnish.Select.closestItemAxisProps[e],j=Garnish.Select.closestItemDirectionProps[f];var p=c(this.$items[k]),o=p.offset(),q=o[d.midpointOffset]+Math.round(p[d.midpointSizeFunc]()/2),l=null,m=null,t=null;for(var g=k+j.step;(typeof this.$items[g]!="undefined");g+=j.step){var n=c(this.$items[g]),s=n.offset();if(j.isNextRow(s[d.rowOffset],o[d.rowOffset])){if(l===null){l=s[d.rowOffset]}else{if(s[d.rowOffset]!=l){break}}var r=s[d.midpointOffset]+Math.round(n[d.midpointSizeFunc]()/2),h=Math.abs(q-r);if(m===null||h<m){m=h;t=n}else{break}}else{if(j.isWrongDirection(s[d.rowOffset],o[d.rowOffset])){break}}}return t},getFurthestItemToTheLeft:function(d){return this.getFurthestItem(d,"ToTheLeft")},getFurthestItemToTheRight:function(d){return this.getFurthestItem(d,"ToTheRight")},getFurthestItemAbove:function(d){return this.getFurthestItem(d,"Above")},getFurthestItemBelow:function(d){return this.getFurthestItem(d,"Below")},getFurthestItem:function(g,f){var e,d;while(d=this["getItem"+f](g)){e=d;g=this.getItemIndex(e)}return e},getTotalSelected:function(){return this.totalSelected},addItems:function(d){var h=c(d);for(var e=0;e<h.length;e++){var f=h[e];if(c.data(f,"select")){Garnish.log("Element was added to more than one selector");c.data(f,"select").removeItems(f)}c.data(f,"select",this);this.$items=this.$items.add(f);if(this.settings.handle){if(typeof this.settings.handle=="object"){var g=c(this.settings.handle)}else{if(typeof this.settings.handle=="string"){var g=c(f).find(this.settings.handle)}else{if(typeof this.settings.handle=="function"){var g=c(this.settings.handle(f))}}}}else{var g=c(f)}c.data(f,"select-handle",g);g.data("select-item",f);this.addListener(g,"mousedown","onMouseDown");this.addListener(g,"mouseup","onMouseUp");this.addListener(g,"keydown","onKeyDown");this.addListener(g,"click",function(i){this.ignoreClick=true})}this.totalSelected+=h.filter("."+this.settings.selectedClass).length;this.updateIndexes()},removeItems:function(d){d=c.makeArray(d);for(var f=0;f<d.length;f++){var g=d[f];var e=c.inArray(g,this.$items);if(e!=-1){var h=c.data(g,"select-handle");h.data("select-item",null);c.data(g,"select",null);c.data(g,"select-handle",null);this.removeAllListeners(h);this.$items.splice(e,1)}}this.updateIndexes()},refreshItemOrder:function(){this.$items=c(this.$items)},destroy:function(){this.base();this.clearCallbackTimeout()},updateIndexes:function(){if(this.first!==null){this.first=this.getItemIndex(this.$first);this.last=this.getItemIndex(this.$last);this.setFocusableItem(this.$first)}else{if(this.$items.length){this.setFocusableItem(c(this.$items[0]))}}},resetItemOrder:function(){this.$items=c().add(this.$items);this.updateIndexes()},setFocusableItem:function(d){if(this.$focusable){this.$focusable.removeAttr("tabindex")}this.$focusable=d.attr("tabindex","0")},clearCallbackTimeout:function(){if(this.settings.onSelectionChange){clearTimeout(this.callbackTimeout)}},setCallbackTimeout:function(){if(this.settings.onSelectionChange){this.clearCallbackTimeout();this.callbackTimeout=setTimeout(c.proxy(function(){this.callbackTimeout=null;this.settings.onSelectionChange()},this),300)}},getSelectedItems:function(){return this.$items.filter("."+this.settings.selectedClass)}},{defaults:{selectedClass:"sel",multi:false,vertical:false,horizontal:false,waitForDblClick:false,arrowsChangeSelection:true,handle:null,onSelectionChange:c.noop},closestItemAxisProps:{x:{midpointOffset:"top",midpointSizeFunc:"outerHeight",rowOffset:"left"},y:{midpointOffset:"left",midpointSizeFunc:"outerWidth",rowOffset:"top"}},closestItemDirectionProps:{"<":{step:-1,isNextRow:function(e,d){return(e<d)},isWrongDirection:function(e,d){return(e>d)}},">":{step:1,isNextRow:function(e,d){return(e>d)},isWrongDirection:function(e,d){return(e<d)}}}});Garnish.SelectMenu=Garnish.Menu.extend({init:function(e,d,f,g){if(typeof f=="function"){g=f;f={}}f=c.extend({},Garnish.SelectMenu.defaults,f);this.base(e,d,f,g);this.selected=-1},build:function(){this.base();if(this.selected!=-1){this._addSelectedOptionClass(this.selected)}},select:function(d){if(d==this.selected){return}if(this.dom.ul){if(this.selected!=-1){this.dom.options[this.selected].className=""}this._addSelectedOptionClass(d)}this.selected=d;this.setBtnText(c(this.options[d].label).text());this.base(d)},_addSelectedOptionClass:function(d){this.dom.options[d].className="sel"},setBtnText:function(d){this.dom.$btnLabel.text(d)}},{defaults:{ulClass:"menu select"}})})(jQuery);