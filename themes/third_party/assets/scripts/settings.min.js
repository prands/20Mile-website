(function(b){if(typeof window.Assets=="undefined"){window.Assets={}}Assets.onAllFiledirsChange=function(e){var f=b(e),d=!!f.attr("checked"),g=b("input",f.parent().parent().next());g.attr({checked:d,disabled:d})};b(".assets-view").each(function(){var e=b(".assets-view-thumbs",this),d=b(".assets-view-list",this),f=b(this).parent().parent().next().hide();e.change(function(){f.hide()});d.change(function(){f.show()})});b("form#source_form").keydown(function(f){var d=(f.which)?f.which:event.keyCode;if(d==13){f.stopPropagation();b(this).find("input:last").click()}}).submit(function(d){if(b("input#source_name").val().length<1){d.preventDefault()}});var a=b();function c(){var d=a.find(":selected");b("#bucket_location").val(d.attr("data-location"));b("#bucket_url_prefix").val(d.attr("data-url-prefix"))}b(".refresh_buckets").live("click",function(d){d.preventDefault();var f={ACT:Assets.actions.get_s3_buckets};b("input.setting_field").each(function(){f[b(this).prop("name")]=b(this).val()});b("#buckets").html('<div class="assets-loading"></div>');b.post(Assets.siteUrl,f,function(e){b("#buckets").html(e);a=b("#buckets > select");a.change(c);c()})});b(".delete_source").click(function(){var d=b(this).attr("data-source-name");if(confirm(Assets.lang.confirm_delete_source.replace("{source}",d))){var e=b(this).attr("data-source-id");b("#source_id").val(e);b("form#delete_source").submit()}});b("input.assets-index").click(function(){var e=b(this);if(e.hasClass("disabled")){return}e.addClass("disabled");var d=b("input.indexing:checked");b("div#assets-dialog div#index-status-report").empty();b("div#assets-dialog div#index-message").empty();if(d.length>0){b.post(Assets.siteUrl,{ACT:Assets.actions.get_session_id},function(h){h=b.evalJSON(h);var i=h.session;var g=[];var f=new Assets.AjaxQueueManager(10,function(){b("input.assets-index.disabled").removeClass("disabled");b("div.progress-bar").remove();var j=[];d.each(function(){j.push(b(this).attr("id"))});var k={ACT:Assets.actions.finish_index,session:i,command:b.toJSON({command:"statistics"}),sources:j.join(",")};b.post(Assets.siteUrl,k,function(o){o=b.evalJSON(o);if(typeof g.length>0||typeof o.files!="undefined"){b("div#assets-dialog div#index-message").html(Assets.lang.index_stale_entries_message);var m="";if(g.length>0){m+='<div class="index-data-container"><strong>'+Assets.lang.index_folders+"</strong>";for(var l=0;l<g.length;l++){m+='<div><label><input type="checkbox" checked="checked" class="delete_folder" value="'+g[l].folder_id+'" /> '+f.missing_folders[l].folder_name+"</label></div>"}m+="</div>"}if(typeof o.files!="undefined"){m+='<div class="index-data-container"><strong>'+Assets.lang.index_files+"</strong>";for(var n in o.files){m+='<div><label><input type="checkbox" checked="checked" class="delete_file" value="'+n+'" /> '+o.files[n]+"</label></div>"}m+="</div>"}m+='<br /><input type="button" class="submit" value="'+Assets.lang._delete+'" onclick="deleteSelectedFiles();"/>';b("#index-status-report").empty().append(m)}else{b("div#assets-dialog div#index-status-report").empty();b("div#index-message").html(Assets.lang.index_complete)}b("div#assets-dialog").show()})});d.each(function(){b(this).parent().find(".progress-bar").remove().end().append('<div class="progress-bar"><div class="progress-filler"></div></div>');var j=b(this).siblings(".progress-bar");var k={ACT:Assets.actions.start_index,source:b(this).attr("id"),session:i};f.addItem(Assets.siteUrl,k,function(n){n=b.evalJSON(n);j.attr("total",n.total).attr("current",0);for(var m=0;m<n.total;m++){k={ACT:Assets.actions.perform_index,session:i,source_type:n.source_type,source_id:n.source_id,offset:m};f.addItem(Assets.siteUrl,k,function(){var p=parseInt(j.attr("current"),10);j.attr("current",++p);var o=Math.min(Math.ceil(100/j.attr("total")*p),100)+"%";j.find(".progress-filler").stop().animate({width:o},70,"linear")})}for(var l in n.missing_folders){g.push({folder_id:l,folder_name:n.missing_folders[l]})}})});f.startQueue()})}else{e.removeClass("disabled")}})})(jQuery);function deleteSelectedFiles(){var b={};b.command="delete";b.folder_ids=[];b.file_ids=[];$("div#assets-dialog input.delete_folder:checked").each(function(){b.folder_ids.push($(this).val())});$("div#assets-dialog input.delete_file:checked").each(function(){b.file_ids.push($(this).val())});var a={ACT:Assets.actions.finish_index,command:$.toJSON(b)};$.post(Assets.siteUrl,a,function(){$("div#assets-dialog div#index-status-report").empty();$("#index-message").html(Assets.lang.index_complete)})};